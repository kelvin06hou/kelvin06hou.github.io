<!doctype html>
<html lang="zh-Hant">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Notebook Embed</title>
		<style>
			body { font-family: Arial, sans-serif; margin: 24px; }
			.frame-wrap { width: 100%; height: 80vh; border: 1px solid #ddd; }
			.fallback { margin-top: 12px; }
		</style>
	</head>
	<body>
		<div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
			<button id="reloadBtn">重新載入 Notebook（取最新）</button>
			<span id="lastLoaded" style="color:#666;font-size:0.95rem;"></span>
		</div>
		<iframe id="nbframe" src="test_notebook.html?v=1" title="test_notebook.html" frameborder="0" aria-label="Embedded notebook"></iframe>

		<script>
		// 自動調整 iframe 高度以配合內容（若同源可讀取內容高度）
		function adjustIframe() {
			const ifr = document.getElementById('nbframe');
			if (!ifr) return;
			// 預設為視窗高度，避免在無法存取內容時顯示空白
			ifr.style.width = '100%';
			ifr.style.display = 'block';
			ifr.style.border = '0';
			try {
				const doc = ifr.contentDocument || ifr.contentWindow.document;
				const height = Math.max(doc.documentElement.scrollHeight || 0, doc.body.scrollHeight || 0, doc.documentElement.offsetHeight || 0);
				if (height && height > 0) {
					ifr.style.height = height + 'px';
				} else {
					ifr.style.height = window.innerHeight + 'px';
				}
			} catch (e) {
				// cross-origin 或其他無法存取情況：使用視窗高度（內部會產生滾動）
				ifr.style.height = window.innerHeight + 'px';
			}
		}

		window.addEventListener('DOMContentLoaded', function () {
			const ifr = document.getElementById('nbframe');
			const btn = document.getElementById('reloadBtn');
			const last = document.getElementById('lastLoaded');
			if (!ifr) return;
			ifr.style.minHeight = '100vh';
			// 在 iframe 加載完成時嘗試調整高度
			ifr.addEventListener('load', function () {
				adjustIframe();
				// 若內容載入後有遲到的資源，延遲再次調整
				setTimeout(adjustIframe, 500);
				// 更新上次載入時間文字
				if (last) last.textContent = '上次載入：' + new Date().toLocaleString();
			});

			// 重新載入時加上時間戳以破壞快取，確保載入最新版
			function loadLatest() {
				const t = Date.now();
				ifr.src = 'test_notebook.html?v=' + t;
			}

			if (btn) btn.addEventListener('click', function () {
				loadLatest();
			});

			// 頁面開啟時自動嘗試載入最新版本
			loadLatest();
			window.addEventListener('resize', adjustIframe);
			// 嘗試首次調整
			adjustIframe();
		});
		</script>
	</body>
</html>

