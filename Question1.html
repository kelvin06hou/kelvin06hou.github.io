<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Q&A Assessment</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .question { margin-bottom: 30px; padding: 0; border: none; }
    hr { margin: 20px 0; border: 0; border-top: 1px solid #ccc; }
    .answers { margin-top: 10px; padding: 10px; background: #f6f6f6; border-radius: 5px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h1>Assessment</h1>
<p id="instructions">Please answer all questions below.</p>

<div id="question-container">Loading questions...</div>
<button id="submit-btn">Submit Answers</button>
<div id="final-score" style="margin-top:20px; font-weight:bold;"></div>

<script>
  const qContainer = document.getElementById('question-container');
  const submitBtn = document.getElementById('submit-btn');
  let questions = [];

  async function loadQuestions() {
    try {
      const res = await fetch('MyQuestion.json');
      questions = await res.json();

      if (!Array.isArray(questions)) {
        qContainer.textContent = 'MyQuestion.json format error: must be a JSON array.';
        return;
      }

      window.totalCredits = questions.reduce((a,q)=>a + (q.credit || 0), 0);

      renderQuestions();
    } catch (e) {
      qContainer.textContent = 'Unable to load MyQuestion.json. Ensure it exists on your server and is valid JSON.';
    }
  }

  function renderQuestions() {
    qContainer.innerHTML = '';

    questions.forEach((q, index) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'question';

      const title = document.createElement('div');
      title.innerHTML = `<strong>Q${index+1}:</strong> ${q.text}`;
      wrapper.appendChild(title);

      if (q.type === 'mcq') {
        q.choices.forEach((c, i) => {
          const row = document.createElement('div');
          row.innerHTML = `
            <label>
              <input type="radio" name="q${index}" value="${i}"> ${c}
            </label>`;
          wrapper.appendChild(row);
        });
      }

      if (q.type === 'fill') {
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.name = `q${index}`;
        inp.style.width = '300px';
        wrapper.appendChild(inp);
      }

      const answerBox = document.createElement('div');
      answerBox.className = 'answers hidden';
      answerBox.id = `answer${index}`;
      wrapper.appendChild(answerBox);

      qContainer.appendChild(wrapper);

      if (index < questions.length - 1) qContainer.appendChild(document.createElement('hr'));
    });
  }

  function revealAnswers() {
    questions.forEach((q, index) => {
      const ansBox = document.getElementById(`answer${index}`);

      let userAnswer;
      if (q.type === 'mcq') {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        userAnswer = selected ? q.choices[selected.value] : '(no answer)';
      } else if (q.type === 'fill') {
        const inp = document.querySelector(`input[name="q${index}"]`);
        userAnswer = inp.value || '(no answer)';
      }

      let correct;
      if (q.type === 'mcq') correct = q.choices[q.correct];
      if (q.type === 'fill') correct = q.blanks.join(', ');

      ansBox.innerHTML = `
        <div><strong>Your Answer:</strong> ${userAnswer}</div>
        <div><strong>Correct Answer:</strong> ${correct}</div>
      `;

      ansBox.classList.remove('hidden');
    });
  }

  function calculateScore() {
    let earned = 0;

    questions.forEach((q, index) => {
      if (q.credit === undefined) return;

      if (q.type === 'mcq') {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        if (selected && parseInt(selected.value) === q.correct) earned += q.credit;
      }

      if (q.type === 'fill') {
        const inp = document.querySelector(`input[name="q${index}"]`);
        if (inp && q.blanks.some(b => b.toLowerCase().trim() === inp.value.toLowerCase().trim())) earned += q.credit;
      }
    });

    const percent = window.totalCredits ? ((earned / window.totalCredits) * 100).toFixed(2) : '0.00';
    document.getElementById('final-score').textContent = `Final Score: ${percent}%`;
  }

  submitBtn.addEventListener('click', () => {
    revealAnswers();
    calculateScore();
  });

  loadQuestions();
</script>

</body>
</html>